"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const base_1 = __importDefault(require("./base"));
class CityHTTPClient extends base_1.default {
    get(market, id, path) {
        return new Promise((resolve, reject) => {
            const response = this.makeCall(market, path);
            response
                .then((d) => {
                const dt = d;
                // eslint-disable-next-line no-plusplus
                for (let i = 0; i < d.length; i++) {
                    const curr = dt[i];
                    curr.id = curr.locode;
                    delete curr.locode;
                    dt[i] = curr;
                }
                const IMarket = {
                    id: market,
                    cities: dt,
                };
                let found = false;
                // eslint-disable-next-line no-plusplus
                for (let i = 0; i < IMarket.cities.length; i++) {
                    const currCity = IMarket.cities[i];
                    if (currCity.id === id) {
                        resolve(currCity);
                        found = true;
                    }
                }
                if (!found) {
                    throw new Error("No such city");
                }
            })
                .catch(CityHTTPClient.errorHandler(reject));
        });
    }
}
exports.default = CityHTTPClient;
